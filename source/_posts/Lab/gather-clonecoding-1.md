---
title: "[토이프로젝트] 개더타운 클론코딩 - 1"
date: 2022-07-20 02:14:38
categories: [토이프로젝트]
tags: [토이프로젝트, WebRTC, Phaser]
---

# MOTIVATION

나는 코딩이던 미싱이던 그림이던 단시간에 머리를 풀가동해서 결과물을 끌어내는것을 좋아한다.  
사실 이런 챌린지를 기획할 때 제일 어려운 점은 목표를 정하는 것이다. 끝내는 데에 시간이 N시간 정도면 되겠다 싶으면서도 그 시간 동안 끊임없이 흥미와 도전정신을 끌어올릴 수 있는 목표를 정해야하기 때문이다. 말 그대로 시작이 반인 셈 ㅎㅎ

멘탈 상태가 좋을 때는 이런 아이디어가 샘솟는데 최근에는 이래저래 의욕이 하나도 없어서 침체되어있다가... 간만에 주말에 시간이 생겨서 일을 벌려 보았다.

요즘 업무하면서 정말 유용하게 사용하고 있는 개더타운을 참고하여 화상채팅 웹사이트를 구현해보려고 한다. 이런 주제를 선정하게 된 이유는 다음과 같다.

- 정제된 전체 가이드나 소스가 흔히 돌아다니지 않는 듯 하다. 개발하면서 제일 꿀맛은 개척하는 맛이니까
- 평소에 궁금했던 웹 기술 분야를 세 개나 체험할 수 있다.
  - WebSocket 통신 (을 사용하는 줄 알았지만 뒤에 가서 WebRTC 라는 것을 깨닫게 될 예정) 체험하기
  - HTML5 게임 개발 라이브러리 또는 프레임워크 서칭 및 체험하기
  - 인기 있는 디자인 시스템 서칭 및 체험하기

# PREPARATION

## 개더타운은 무엇으로 만들어져있나?

REST api를 주로 설계/개발해왔기 때문에 실시간 통신에 대해 아는 것이 없어서, 막연하게 '개더타운은 WebSocket으로 뭔가 되어있지 않을까?' 라고 생각했다.  
물론 그러면서도 어떻게 그 많은 사람이 음성 / 비디오를 서로 전송하고 있을까... 서버가 중간에서 이 많은 미디어를 다 나누어주고 있다면 개더타운은 어떻게 공짜인걸까... 생각은 했으나 그 뒤까지는 몰랐다.
찾아보니 개더타운은 P2P로 미디어 또는 임의의 데이터를 주고받을 수 있는 WebRTC를 사용하고 있고, WebRTC은 이미 오래전부터 많은 곳에서 (게임, 화상회의, 휘발성 채팅) 쓰이고 있다고 한다. 떠올려보니 회의 참여자 중 로컬 자원을 많이 쓰고 있는 사람이 포함되어 있을 때 내 게더타운이 약간 느려지는 현상이 종종 있었는데 P2P라서 그랬던 걸 수 있다는 생각이 든다.

메인 기술 셋을 알아냈으니 WebRTC에 대해 구글링해봤다. 생각보다 공식 가이드 및 샘플이 탄탄해서 처음 접하는 기술임에도 왠지 순탄히 진행될 것 같다. 찾은 리소스는 아래와 같이 리스트업 해둔다.

- [잘 정리된 공식 가이드](https://webrtc.org/getting-started/firebase-rtc-codelab)
- [잘 정리된 공식 샘플코드](https://webrtc.github.io/samples)
- [Mozilla의 WebRTC 설명](https://developer.mozilla.org/ko/docs/Web/API/WebRTC_API/Signaling_and_video_calling)

## 어떻게 만들까?

개더타운에 접속해서 F12도 켜보고, 구글링으로 찾은 가이드도 읽어어 보니 어느정도 아키텍처는 그려진 것 같다.
<image src="/images/webrtc_layout.png" />
각 항목에 대한 설명은 다음과 같다.

- Signaling Server 구성 : **Django with djangoRestFramework**
  WebRTC 자체는 P2P 방식이라 미디어 교환 자체를 위해서는 중간다리 역할을 하는 서버가 필요없지만, 맨 처음 통신을 시작할 때 Client 간의 메시지 포맷 등을 협의 (Signaling) 하기 위한 서버가 필요하다고 한다. 요건 오랜만에 Django로 만들어보기로 한다.
- 화면구성
  - 뼈대 : **React.js with Chakra UI**
    화면 디자인 및 스타일링 작업도 재미있고 신나는 일이지만 요즘 표준 없는 UX/UI (정확히는 FE 개발자 - UX/UI 협업 표준의 부재(?) 또는 어려움(?)..)에 현타를 느끼고 있어서, 유명한 디자인 시스템을 써보기로 했다. 검색하면 여러 개의 빵빵한 디자인 시스템이 나오는데, 그 중 나는 [Chakra UI](https://www.npmjs.com/package/@chakra-ui/react)를 써보기로 했다.
  - 맵 및 캐릭터 렌더 : **Phaser**
    HTML5 게임 개발 라이브러리 / 프레임워크에 대해서도 서칭을 했고, 최종으로는 Phaser와 PixiJS 두 개가 후보에 올랐다. 처음 관심 가져본 분야여서 판단을 내리기 어려웠는데 [요 글](https://stackoverflow.com/questions/38509629/decide-pixi-js-or-phaser)이 큰 도움이 됐다. 내가 이해한 바를 키워드로 요약하자면 편리함(Phaser) vs 자유도(PixiJS) 같다. PixiJS를 쓰면 좀 더 deep하게 이해할 수 있을 것 같아서 10초 정도 고민됐는데, 욕심 같아서 포기했다. 이번에는 Phaser를 사용해보고, 다음에 HTML5 게임 개발이 정말 하고 싶어지면 그때 PixiJS를 써보자.  
    +) 뜬금없지만 [Phaser 웹사이트](https://phaser.io/)가 너무나 2000년대 감성이다.
- 미디어 전송 : **WebRTC**

## 무엇부터 어떤 순서로 만들까?

이번 사이드 프로젝트에서 제일 큰 수확이 요 스텝이라고 생각한다. 일정에 쫒기며 떠밀리듯이 개발하는 것이 요즘 내 개발 기피(?)의 원인이라고 생각하기 때문에 토이 프로젝트 만큼은 그렇게 진행하지 않으려고 노력했다. 사실 과거를 돌아보면 나는 토이 프로젝트도 그렇게 일정에 쫒기며 했던 사람이었긴하다 ㅋㅋㅋ 물론 오버웤이 내 의지였냐는 또 다른 문제긴 하지만...

---

아모튼!! 이제는 그렇게 일하지 않으리라.. 다짐하면서 개발에 착수하기 전 내가 한 고민들을 적어보면 다음과 같다.

**고민1️⃣** 다음 중 내가 우선 시 하는 것은 무엇인가?

- 내가 할애하려고 계획한 에포트 이상은 들이지 않고 진행하기
- 내가 마무리하려고 계획한 날짜까지는 끝내기
- 내가 계획했던 수준까지는 결과물의 퀄리티 내기
  - 외적인 퀄리티 (기능성, 사용성, 심미성 등등)
  - 내적인 퀄리티 (코드 품질)

**고민2️⃣** 목표 기간 내에 효율적이고 빠르게 작업을 하려면 어떻게 일을 쪼개고, 어떤 순서로 일을 해야할까?

**고민3️⃣** 작업 내용이 대부분 내가 처음 해보는 것이라면, 내가 아는 일을 할 때와 어떻게 다르게 일해야할까?

---

그리고 위 고민에 대한 결론은 요렇게 냈다. 물론 앞으로 계속해서 개정해나갈 예정이다 ㅎㅎ 실험🧪적인 것도 있고 ㅋㅋㅋ

**고민1️⃣** 다음 중 내가 우선 시 하는 것은 무엇인가?
**결론💡** 이 토이 프로젝트에서 나는 `내적인 퀄리티 > 마감일 지키기 > 에포트 지키기 > 외적인 퀄리티` 순서대로 중요하게 생각할 것이다.

1. 내적인 퀄리티 기준 : `Github public repo에 공개할 수 있는 수준` 으로
2. 마감일 지키기 기준 : 8/28
3. 에포트 지키기 기준 : `평일은 MAX 하루 3시간 이내, 주말은 하루 골라서 MAX 반나절만` 투자
4. 외적인 퀄리티 기준 : 뭐 그냥 데모 가능한 정도로만?
   나는 요게 제일 신선했다. 실제로 내가 토이 플젝을 하면서 들였던 시간의 꽤 많은 부분이 외적인 퀄리티에 있었는데,
   정작 진지하게 내가 이것을 얼마나 중요하게 생각하는가를 생각해보았더니 사실은 내가 외적인 퀄리티의 중요도를 별로 높게 생각하고 있지 않았다. 작은 부분이 눈에 거슬리면 '에이 뭐 별로 안걸리는데 지금 금방 고칠까' 하는 마음에 바로 바로 코드에 손을 대는 것이 누적되어 결과적으로 시간을 많이 쏟은 셈이 되었던 것 같다. 한 눈을 팔았다고 해야하나... 아무튼 시간을 내어 이런 고민을 했던 것이 이번 토이 프로젝트 최고의 수확인 것 같다. 👍

**고민2️⃣** 목표 기간 내에 효율적이고 빠르게 작업을 하려면 어떻게 일을 쪼개고, 어떤 순서로 일을 해야할까?
**결론💡** 이 토이 프로젝트에서 나는 성취감을 느낄수 있는 최소한의 단위로 일을 쪼개고, 요렇게 쪼갠 일들을 다시 연관된 것들 끼리 뭉쳐서 진행할 것이다. 각 항목에서 성취할 수 있는 내용은 🎁 표시로 적어봤다.

1. git repository 생성 및 각 모듈 셋업하기
   🎁 React, Django 셋업과정
2. 화면 뼈대 구성하기
   🎁 Chakra 사용법
3. 맵 구성하기
   🎁 Phaser 사용법
   🎁 Phaser와 React.js를 함께 사용하는 과정
4. 캐릭터 이동 구현하기
5. 회의실 입장 구현하기
6. 2인 음성 영상 챗 구현하기
   🎁 WebRTC 예제 이해 및 응용
7. 다자 음성 영상 챗 구현하기
8. 미디어 설정 기능 구현하기

**고민3️⃣** 작업 내용이 대부분 내가 처음 해보는 것이라면, 내가 아는 일을 할 때와 어떻게 다르게 일해야할까?
**결론🧪** 이 토이 프로젝트에서 나는 현재 작업 마무리 직후 다음 작업 내용에 대한 서칭을 하고, 실제 다음 작업 까지 약간의 텀을 두고 스스로에게 고민할 시간을 의도적으로 줄 것이다.

- 생각보다 멍때릴때 나오는 코드가 각잡고 짠 코드보다 선방하는 것 같아서 ㅋㅋㅋ 이번에 실험해본다.

DELEVERY 단계부터는 내용이 길어져서 다음 포스트에서 이어서 정리한다 :)
